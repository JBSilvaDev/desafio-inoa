{% extends 'base.html' %}
{% load static %}
{% block titulo %}
Detalhes Page
{% endblock %}
{% block body %}


<body>
  <p>
    Barra de navegação - Favoritos/login/cadastro/logout
  </p>
  <Botao>Botao para remover favorito / Botao para adicionar ou remover da carteira</p>
    <p>
      Página de detalhes do ativo clicado
    </p>
    <section class="ativos-list">
      <ul>
        <li>{{ ativo.id }}</li>
        <li>{{ ativo.cod_ativo }}</li>
        <li>{{ ativo.nome_empresa }}</li>
      </ul>
      <br>
      <form method="POST" action="{% url 'detalhes_ativos' ativo.id %}">
        {% csrf_token %}
        <button type="submit" name="+f">+FAVORITO</button>
        <button type="submit" name="-f">-FAVORITO</button>
        <button type="submit" name="+c">+CARTEIRA</button>
        <button type="submit" name="-c">-CARTEIRA</button>
      </form>
    </section>
    <!-- <section>
      {{ plot_div|safe }}
    </section> -->

    <div id="plot"></div>

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    

    <script>
      function updateChart() {
          $.ajax({
              url: '{% url "update_data" id=ativo.id %}',
              type: 'GET',
              dataType: 'json',
              success: function(data) {
    console.log(data);

    const xData = data.x.map(dateString => new Date(dateString));

    Plotly.newPlot('plot', [{
        x: xData,
        y: data.y,
        type: 'line',
        markers: {color: 'blue'},
        name: data.title,
    }], {
        annotations: data.y.map((value, index) => ({
            x: xData[index],
            y: value,
            xref: 'x',
            yref: 'y',
            text: value.toFixed(2),
            showarrow: false,
            arrowhead: 4,
            ax: 0,
            ay: -30,
        })),
    });

    setTimeout(updateChart, 10000);
}

          });
      }
  
      $(document).ready(function() {
          updateChart();
      });
  </script>
  
</body>

{% endblock %}